{"version":3,"sources":["../../../server/config/strategies/facebook.js"],"names":["passport","require","url","FacebookStrategy","Strategy","config","users","module","exports","use","clientID","facebook","clientSecret","callbackURL","passReqToCallback","req","accessToken","refreshToken","profile","done","providerData","_json","providerUserProfile","firstName","name","givenName","lastName","familyName","fullName","displayName","email","emails","value","username","provider","providerId","id","saveOAuthUserProfile"],"mappings":"AAAA;AACA;;AAEA;;AACA,IAAIA,WAAWC,QAAQ,UAAR,CAAf;AAAA,IACCC,MAAMD,QAAQ,KAAR,CADP;AAAA,IAECE,mBAAmBF,QAAQ,mBAAR,EAA6BG,QAFjD;AAAA,IAGCC,SAASJ,QAAQ,cAAR,CAHV;AAAA,IAICK,QAAQL,QAAQ,+CAAR,CAJT;;AAMA;AACAM,OAAOC,OAAP,GAAiB,YAAW;AAC3B;AACAR,UAASS,GAAT,CAAa,IAAIN,gBAAJ,CAAqB;AAChCO,YAAUL,OAAOM,QAAP,CAAgBD,QADM;AAEhCE,gBAAcP,OAAOM,QAAP,CAAgBC,YAFE;AAGhCC,eAAaR,OAAOM,QAAP,CAAgBE,WAHG;AAIhCC,qBAAmB;AAJa,EAArB,EAMZ,UAASC,GAAT,EAAcC,WAAd,EAA2BC,YAA3B,EAAyCC,OAAzC,EAAkDC,IAAlD,EAAwD;AACvD;AACA,MAAIC,eAAeF,QAAQG,KAA3B;AACAD,eAAaJ,WAAb,GAA2BA,WAA3B;AACAI,eAAaH,YAAb,GAA4BA,YAA5B;;AAEA;AACA,MAAIK,sBAAsB;AACzBC,cAAWL,QAAQM,IAAR,CAAaC,SADC;AAEzBC,aAAUR,QAAQM,IAAR,CAAaG,UAFE;AAGzBC,aAAUV,QAAQW,WAHO;AAIzBC,UAAOZ,QAAQa,MAAR,CAAe,CAAf,EAAkBC,KAJA;AAKzBC,aAAUf,QAAQe,QALO;AAMzBC,aAAU,UANe;AAOzBC,eAAYjB,QAAQkB,EAPK;AAQzBhB,iBAAcA;AARW,GAA1B;;AAWA;AACAd,QAAM+B,oBAAN,CAA2BtB,GAA3B,EAAgCO,mBAAhC,EAAqDH,IAArD;AACA,EA1BW,CAAb;AA4BA,CA9BD","file":"facebook.js","sourcesContent":["// Invoke 'strict' JavaScript mode\n'use strict';\n\n// Load the module dependencies\nvar passport = require('passport'),\n\turl = require('url'),\n\tFacebookStrategy = require('passport-facebook').Strategy,\n\tconfig = require('../../config'),\n\tusers = require('../../app/controllers/users.server.controller');\n\n// Create the Facebook strategy configuration method\nmodule.exports = function() {\n\t// Use the Passport's Facebook strategy \n\tpassport.use(new FacebookStrategy({\n\t\t\tclientID: config.facebook.clientID,\n\t\t\tclientSecret: config.facebook.clientSecret,\n\t\t\tcallbackURL: config.facebook.callbackURL,\n\t\t\tpassReqToCallback: true\n\t\t},\n\t\tfunction(req, accessToken, refreshToken, profile, done) {\n\t\t\t// Set the user's provider data and include tokens\n\t\t\tvar providerData = profile._json;\n\t\t\tproviderData.accessToken = accessToken;\n\t\t\tproviderData.refreshToken = refreshToken;\n\n\t\t\t// Create the user OAuth profile\n\t\t\tvar providerUserProfile = {\n\t\t\t\tfirstName: profile.name.givenName,\n\t\t\t\tlastName: profile.name.familyName,\n\t\t\t\tfullName: profile.displayName,\n\t\t\t\temail: profile.emails[0].value,\n\t\t\t\tusername: profile.username,\n\t\t\t\tprovider: 'facebook',\n\t\t\t\tproviderId: profile.id,\n\t\t\t\tproviderData: providerData\n\t\t\t};\n\n\t\t\t// Save the user OAuth profile\n\t\t\tusers.saveOAuthUserProfile(req, providerUserProfile, done);\n\t\t}\n\t));\n};\n"]}